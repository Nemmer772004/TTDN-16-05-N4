<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Tree View -->
    <record id="view_cham_cong_tree" model="ir.ui.view">
        <field name="name">cham_cong.tree</field>
        <field name="model">cham_cong</field>
        <field name="arch" type="xml">
            <tree string="Danh sách chấm công" decoration-success="trang_thai=='dung_gio'" 
                  decoration-warning="trang_thai in ['tre','som','tre_va_som']" 
                  decoration-danger="trang_thai=='vang_mat'"
                  decoration-info="trang_thai=='tang_ca'">
                <field name="name"/>
                <field name="ngay_cham"/>
                <field name="nhan_vien_id"/>
                <field name="ma_dinh_danh"/>
                <field name="don_vi_id"/>
                <field name="gio_vao" widget="datetime"/>
                <field name="gio_ra" widget="datetime"/>
                <field name="tong_gio_lam" widget="float_time"/>
                <field name="gio_tang_ca" widget="float_time"/>
                <field name="phut_tre"/>
                <field name="phut_ve_som"/>
                <field name="trang_thai"/>
                <field name="da_phe_duyet" invisible="1"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_cham_cong_form" model="ir.ui.view">
        <field name="name">cham_cong.form</field>
        <field name="model">cham_cong</field>
        <field name="arch" type="xml">
            <form string="Chấm công">
                <header>
                    <button name="action_check_in" string="Check In" type="object" 
                            class="oe_highlight" attrs="{'invisible': [('gio_vao', '!=', False)]}"/>
                    <button name="action_check_out" string="Check Out" type="object" 
                            class="oe_highlight" attrs="{'invisible': ['|', ('gio_vao', '=', False), ('gio_ra', '!=', False)]}"/>
                    <button name="action_gui_duyet" string="Gửi phê duyệt" type="object" 
                            class="btn-primary" attrs="{'invisible': ['|', ('can_phe_duyet', '=', True), ('da_phe_duyet', '=', True)]}"/>
                    <button name="action_phe_duyet" string="Phê duyệt" type="object" 
                            class="oe_highlight" attrs="{'invisible': ['|', ('can_phe_duyet', '=', False), ('da_phe_duyet', '=', True)]}"/>
                    <field name="trang_thai" widget="statusbar" statusbar_visible="dung_gio,tre,som,tang_ca"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button" options='{"terminology": "archive"}'/>
                        </button>
                    </div>
                    
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    
                    <group>
                        <group string="Thông tin nhân viên">
                            <field name="nhan_vien_id" options="{'no_create': True}"/>
                            <field name="ma_dinh_danh"/>
                            <field name="don_vi_id"/>
                            <field name="ngay_cham"/>
                        </group>
                        <group string="Giờ làm việc chuẩn">
                            <field name="gio_vao_chuan" widget="float_time"/>
                            <field name="gio_ra_chuan" widget="float_time"/>
                            <field name="gio_lam_chuan" widget="float_time"/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Thời gian chấm công">
                            <field name="gio_vao"/>
                            <field name="gio_ra"/>
                            <field name="tong_gio_lam" widget="float_time"/>
                        </group>
                        <group string="Thống kê">
                            <field name="gio_tang_ca" widget="float_time"/>
                            <field name="phut_tre"/>
                            <field name="phut_ve_som"/>
                        </group>
                    </group>
                    
                    <group string="Phê duyệt" attrs="{'invisible': [('can_phe_duyet', '=', False)]}">
                        <field name="can_phe_duyet" invisible="1"/>
                        <field name="da_phe_duyet"/>
                        <field name="nguoi_phe_duyet_id"/>
                        <field name="ngay_phe_duyet"/>
                    </group>
                    
                    <group string="Ghi chú">
                        <field name="ghi_chu" nolabel="1" placeholder="Nhập ghi chú..."/>
                        <field name="ly_do_vang" nolabel="1" placeholder="Lý do vắng mặt..." 
                               attrs="{'invisible': [('trang_thai', '!=', 'vang_mat')]}"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View -->
    <record id="view_cham_cong_search" model="ir.ui.view">
        <field name="name">cham_cong.search</field>
        <field name="model">cham_cong</field>
        <field name="arch" type="xml">
            <search string="Tìm kiếm chấm công">
                <field name="nhan_vien_id"/>
                <field name="ma_dinh_danh"/>
                <field name="don_vi_id"/>
                <field name="ngay_cham"/>
                <filter string="Hôm nay" name="today" domain="[('ngay_cham', '=', context_today().strftime('%Y-%m-%d'))]"/>
                <filter string="Tuần này" name="this_week" domain="[('ngay_cham', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d'))]"/>
                <filter string="Tháng này" name="this_month" domain="[('ngay_cham', '&gt;=', (context_today().replace(day=1)).strftime('%Y-%m-%d'))]"/>
                <separator/>
                <filter string="Đúng giờ" name="dung_gio" domain="[('trang_thai', '=', 'dung_gio')]"/>
                <filter string="Đi trễ" name="tre" domain="[('trang_thai', 'in', ['tre', 'tre_va_som'])]"/>
                <filter string="Về sớm" name="som" domain="[('trang_thai', 'in', ['som', 'tre_va_som'])]"/>
                <filter string="Vắng mặt" name="vang_mat" domain="[('trang_thai', '=', 'vang_mat')]"/>
                <filter string="Tăng ca" name="tang_ca" domain="[('trang_thai', '=', 'tang_ca')]"/>
                <separator/>
                <filter string="Chờ phê duyệt" name="cho_phe_duyet" domain="[('can_phe_duyet', '=', True), ('da_phe_duyet', '=', False)]"/>
                <filter string="Đã phê duyệt" name="da_phe_duyet" domain="[('da_phe_duyet', '=', True)]"/>
                <group expand="0" string="Group By">
                    <filter string="Nhân viên" name="group_nhan_vien" context="{'group_by': 'nhan_vien_id'}"/>
                    <filter string="Phòng ban" name="group_phong_ban" context="{'group_by': 'don_vi_id'}"/>
                    <filter string="Ngày" name="group_ngay" context="{'group_by': 'ngay_cham'}"/>
                    <filter string="Trạng thái" name="group_trang_thai" context="{'group_by': 'trang_thai'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Calendar View -->
    <record id="view_cham_cong_calendar" model="ir.ui.view">
        <field name="name">cham_cong.calendar</field>
        <field name="model">cham_cong</field>
        <field name="arch" type="xml">
            <calendar string="Lịch chấm công" date_start="ngay_cham" color="trang_thai" mode="month">
                <field name="nhan_vien_id"/>
                <field name="trang_thai"/>
                <field name="tong_gio_lam"/>
            </calendar>
        </field>
    </record>

    <!-- Pivot View -->
    <record id="view_cham_cong_pivot" model="ir.ui.view">
        <field name="name">cham_cong.pivot</field>
        <field name="model">cham_cong</field>
        <field name="arch" type="xml">
            <pivot string="Phân tích chấm công">
                <field name="don_vi_id" type="row"/>
                <field name="ngay_cham" interval="month" type="col"/>
                <field name="tong_gio_lam" type="measure"/>
                <field name="gio_tang_ca" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Graph View -->
    <record id="view_cham_cong_graph" model="ir.ui.view">
        <field name="name">cham_cong.graph</field>
        <field name="model">cham_cong</field>
        <field name="arch" type="xml">
            <graph string="Biểu đồ chấm công" type="bar">
                <field name="ngay_cham" interval="month"/>
                <field name="tong_gio_lam" type="measure"/>
                <field name="gio_tang_ca" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Action -->
    <record id="action_cham_cong" model="ir.actions.act_window">
        <field name="name">Chấm công</field>
        <field name="res_model">cham_cong</field>
        <field name="view_mode">tree,form,calendar,pivot,graph</field>
        <field name="context">{'search_default_this_month': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Tạo bản ghi chấm công mới
            </p>
            <p>
                Quản lý chấm công cho nhân viên. Hệ thống tự động tính toán giờ làm, giờ tăng ca, đi trễ, về sớm.
            </p>
        </field>
    </record>

    <!-- Menu Items will be added in menu.xml -->
</odoo>
